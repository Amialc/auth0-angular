!function(){angular.module("auth0",["auth0.service","auth0.utils"]).run(["auth",function(n){n.hookEvents()}]),angular.module("auth0.utils",[]).provider("authUtils",function(){var n={capitalize:function(n){return n?n.charAt(0).toUpperCase()+n.substring(1).toLowerCase():null},fnName:function(n){var t=n.toString();return t=t.substr("function ".length),t=t.substr(0,t.indexOf("(")),t?t.trim():t}};angular.extend(this,n),this.$get=["$rootScope","$q",function(t,i){var e={};return angular.extend(e,n),e.safeApply=function(n){var i=t.$root.$$phase;"$apply"===i||"$digest"===i?n&&"function"==typeof n&&n():t.$apply(n)},e.callbackify=function(n,t,i,r){return angular.isFunction(n)?function(o){o=Array.prototype.slice.call(arguments);var a=function(n,e,r){return n?void(i&&i(n)):(r=Array.prototype.slice.call(arguments,1),void(t&&t.apply(null,r)))};(t||i)&&o.push(e.applied(a)),n.apply(r,o)}:void 0},e.promisify=function(n,t){return angular.isFunction(n)?function(r){r=Array.prototype.slice.call(arguments);var o=i.defer(),a=function(n,t,i){return n?void o.reject(n):(i=Array.prototype.slice.call(arguments,1),void o.resolve(i.length>1?i:t))};return r.push(e.applied(a)),n.apply(t,r),o.promise.spread=o.promise.spread||function(n,t){return o.promise.then(function(t){return Array.isArray(t)?n.apply(null,t):n(t)},t)},o.promise}:void 0},e.applied=function(n){return function(t,i){t=t,i=i;var r=arguments;e.safeApply(function(){n.apply(null,r)})}},e}]}),angular.module("auth0.service",["auth0.utils"]).provider("auth",["authUtilsProvider",function(n){function t(n,t){t=t||o.lib;var i=a[t].library();return i[a[t][n]]}function i(n,t){return t=t||o.lib,a[t][n]}function e(t){if(t)return{lib:n.fnName(t),constructor:t};if(null!=window.Auth0Lock)return{lib:"Auth0Lock",constructor:window.Auth0Lock};if(null!=window.Auth0)return{lib:"Auth0",constructor:window.Auth0};if(null!=Auth0Widget)throw new Error("Auth0Widget is not supported with this version of auth0-angularanymore. Please try with an older one");throw new Error("Cannott initialize Auth0Angular. Auth0Lock or Auth0 must be available")}var r={callbackOnLocationHash:!0},o=this,a={Auth0:{signin:"login",signup:"signup",reset:"changePassword",validateUser:"validateUser",library:function(){return o.auth0js},parseOptions:function(n){var t=angular.copy(n);return t.authParams&&(angular.extend(t,t.authParams),delete t.authParams),t}},Auth0Lock:{signin:"show",signup:"showSignup",reset:"showReset",library:function(){return o.auth0lib},parseOptions:function(n){return angular.copy(n)}}};this.init=function(n,t){if(!n)throw new Error("You must set options when calling init");this.loginUrl=n.loginUrl,this.loginState=n.loginState,this.clientID=n.clientID||n.clientId;var i=n.domain;this.sso=n.sso;var o=e(t);this.lib=o.lib,"Auth0Lock"===o.lib?(this.auth0lib=new o.constructor(this.clientID,i,angular.extend(r,n)),this.auth0js=this.auth0lib.getClient(),this.isLock=!0):(this.auth0lib=new o.constructor(angular.extend(r,n)),this.auth0js=this.auth0lib,this.isLock=!1),this.initialized=!0},this.eventHandlers={},this.on=function(n,t){this.eventHandlers[n]||(this.eventHandlers[n]=[]),this.eventHandlers[n].push(t)};var u=["loginSuccess","loginFailure","logout","forbidden","authenticated"];angular.forEach(u,function(t){o["add"+n.capitalize(t)+"Handler"]=function(n){o.on(t,n)}}),this.$get=["$rootScope","$q","$injector","$window","$location","authUtils",function(n,e,r,u,l,s){function c(){o.loginUrl?l.path(o.loginUrl):o.loginState?r.get("$state").go(o.loginState):d("forbidden")}var h={isAuthenticated:!1},f=function(n){return o.eventHandlers[n]},d=function(t,i){n.$broadcast("auth0."+t,i),angular.forEach(f(t)||[],function(n){r.invoke(n,h,i)})},p=function(n,t,i,e,r,o){var a=h.getProfile(n),u={idToken:n,accessToken:t,state:i,refreshToken:e,profile:r,isAuthenticated:!0};return angular.extend(h,u),d(o?"authenticated":"loginSuccess",angular.extend({profilePromise:a},u)),a};n.$on("$locationChangeStart",function(){if(o.initialized){var n=o.auth0lib.parseHash(u.location.hash);if(!h.isAuthenticated){if(n&&n.id_token)return void p(n.id_token,n.access_token,n.state,n.refresh_token);o.sso&&o.auth0js.getSSOData(s.applied(function(n,t){t.sso&&h.signin({popup:!1,callbackOnLocationHash:!0,connection:t.lastUsedConnection.name},null,null,"Auth0")}))}}}),n.$on("auth0.forbiddenRequest",function(){c()}),o.loginUrl&&n.$on("$routeChangeStart",function(n,t){o.initialized&&t.$$route&&t.$$route.requiresLogin&&(h.isAuthenticated||h.refreshTokenPromise||l.path(o.loginUrl))}),o.loginState&&n.$on("$stateChangeStart",function(n,t){o.initialized&&t.data&&t.data.requiresLogin&&(h.isAuthenticated||h.refreshTokenPromise||(n.preventDefault(),r.get("$state").go(o.loginState)))}),h.config=o;var g=function(n,t){var i=f("loginSuccess");if(!(t||n.username||n.email||i&&0!==i.length))throw new Error("You must define a loginSuccess handler if not using popup mode or not doing ro call because that means you are doing a redirect")};return h.hookEvents=function(){},h.init=angular.bind(o,o.init),h.getToken=function(n){n=n||{scope:"openid"},n.id_token||n.refresh_token||(n.id_token=h.idToken);var t=s.promisify(o.auth0js.getDelegationToken,o.auth0js);return t(n)},h.refreshIdToken=function(n){var t=s.promisify(o.auth0js.refreshToken,o.auth0js);return h.refreshTokenPromise=t(n||h.refreshToken).then(function(n){return n.id_token})["finally"](function(){h.refreshTokenPromise=null}),h.refreshTokenPromise},h.renewIdToken=function(n){var t=s.promisify(o.auth0js.renewIdToken,o.auth0js);return t(n||h.idToken).then(function(n){return n.id_token})},h.signin=function(n,e,r,u){n=n||{},g(n,e,r),n=i("parseOptions",u)(n);var l=t("signin",u),c=e?function(t,i,r,o,a){i||angular.isUndefined(n.loginAfterSignup)||n.loginAfterSignup?p(i,r,o,a,t).then(function(n){e&&e(n,i,r,o,a)}):e()}:null,h=r?function(n){d("loginFailure",{error:n}),r&&r(n)}:null,f=s.callbackify(l,c,h,a[u||o.lib].library());f(n)},h.validateUser=function(n,e,r){n=n||{},n=i("parseOptions")(n);var a=o.auth0lib,u=s.callbackify(t("validateUser"),e,r,a);u(n)},h.signup=function(n,e,r){n=n||{},g(n,e,r),n=i("parseOptions")(n);var a=e?function(t,i,r,o,a){angular.isUndefined(n.auto_login)||n.auto_login?p(i,r,o,a,t).then(function(n){e&&e(n,i,r,o,a)}):e()}:null,u=r?function(n){d("loginFailure",{error:n}),r&&r(n)}:null,l=o.auth0lib,c=s.callbackify(t("signup"),a,u,l);c(n)},h.reset=function(n,e,r){n=n||{},n=i("parseOptions")(n);var a=o.auth0lib,u=s.callbackify(t("reset"),e,r,a);u(n)},h.signout=function(){h.isAuthenticated=!1,h.profile=null,h.profilePromise=null,h.idToken=null,h.state=null,h.accessToken=null,h.tokenPayload=null,d("logout")},h.authenticate=function(n,t,i,e,r){return p(t,i,e,r,n,!0)},h.getProfile=function(n){var t=s.promisify(o.auth0lib.getProfile,o.auth0lib);return h.profilePromise=t(n||h.idToken),h.profilePromise.then(function(n){return h.profile=n,n})},h}]}])}();
