!function(){angular.module("auth0",["auth0.service","auth0.utils"]).run(["auth",function(a){a.hookEvents()}]),angular.module("auth0.utils",[]).provider("authUtils",function(){var a={capitalize:function(a){return a?a.charAt(0).toUpperCase()+a.substring(1).toLowerCase():null}};angular.extend(this,a),this.$get=["$rootScope","$q",function(b,c){var d={};return angular.extend(d,a),d.safeApply=function(a){var c=b.$root.$$phase;"$apply"===c||"$digest"===c?a&&"function"==typeof a&&a():b.$apply(a)},d.callbackify=function(a,b,c,e){return angular.isFunction(a)?function(f){f=Array.prototype.slice.call(arguments);var g=function(a,d,e){return a?void(c&&c(a)):(e=Array.prototype.slice.call(arguments,1),void(b&&b.apply(null,e)))};(b||c)&&f.push(d.applied(g)),a.apply(e,f)}:void 0},d.promisify=function(a,b){return angular.isFunction(a)?function(e){e=Array.prototype.slice.call(arguments);var f=c.defer(),g=function(a,b,c){return a?void f.reject(a):(c=Array.prototype.slice.call(arguments,1),void f.resolve(c.length>1?c:b))};return e.push(d.applied(g)),a.apply(b,e),f.promise.spread=f.promise.spread||function(a,b){return f.promise.then(function(b){return Array.isArray(b)?a.apply(null,b):a(b)},b)},f.promise}:void 0},d.applied=function(a){return function(b,c){b=b,c=c;var e=arguments;d.safeApply(function(){a.apply(null,e)})}},d}]}),angular.module("auth0.service",["auth0.utils"]).provider("auth",["authUtilsProvider",function(a){function b(a,b){b=b||d.lib;var c=e[b].library();return c[e[b][a]]}var c={callbackOnLocationHash:!0},d=this,e={Auth0:{signin:"login",signup:"signup",reset:"changePassword",library:function(){return d.auth0js}},Auth0Lock:{signin:"showSignin",signup:"showSignup",reset:"showReset",library:function(){return d.auth0lib}}};this.init=function(a,b){if(!a)throw new Error("You must set options when calling init");this.loginUrl=a.loginUrl,this.loginState=a.loginState,this.clientID=a.clientID||a.clientId;var d=a.domain;this.sso=a.sso;var e=b;if(e||"undefined"==typeof Auth0Lock||(e=Auth0Lock),e||"undefined"==typeof Auth0||(e=Auth0),"Auth0Widget"===e.name)throw new Error("Auth0Widget is not supported with this  version of auth0-angular anymore. Please try with an older one");"Auth0Lock"===e.name?(this.auth0lib=new e(this.clientID,d,angular.extend(c,a)),this.auth0js=this.auth0lib.getClient(),this.isLock=!0,this.lib="Auth0Lock"):(this.auth0lib=new e(angular.extend(c,a)),this.auth0js=this.auth0lib,this.isLock=!1,this.lib="Auth0")},this.eventHandlers={},this.on=function(a,b){this.eventHandlers[a]||(this.eventHandlers[a]=[]),this.eventHandlers[a].push(b)};var f=["loginSuccess","loginFailure","logout","forbidden","authenticated"];angular.forEach(f,function(b){d["add"+a.capitalize(b)+"Handler"]=function(a){d.on(b,a)}}),this.$get=["$rootScope","$q","$injector","$window","$location","authUtils",function(a,c,f,g,h,i){function j(){d.loginUrl?h.path(d.loginUrl):d.loginState?f.get("$state").go(d.loginState):m("forbidden")}var k={isAuthenticated:!1},l=function(a){return d.eventHandlers[a]},m=function(b,c){a.$broadcast("auth0."+b,c),angular.forEach(l(b)||[],function(a){f.invoke(a,k,c)})},n=function(a,b,c,d,e,f){var g=k.getProfile(a),h={idToken:a,accessToken:b,state:c,refreshToken:d,profile:e,isAuthenticated:!0};return angular.extend(k,h),m(f?"authenticated":"loginSuccess",angular.extend({profilePromise:g},h)),g};a.$on("$locationChangeStart",function(){var a=d.auth0lib.parseHash(g.location.hash);if(!k.isAuthenticated){if(a&&a.id_token)return void n(a.id_token,a.access_token,a.state,a.refresh_token);d.sso&&d.auth0js.getSSOData(i.applied(function(a,b){b.sso&&k.signin({popup:!1,connection:b.lastUsedConnection.strategy},null,null,"Auth0")}))}}),a.$on("auth0.forbiddenRequest",function(){j()}),d.loginUrl&&a.$on("$routeChangeStart",function(a,b){b.$$route&&b.$$route.requiresLogin&&(k.isAuthenticated||h.path(d.loginUrl))}),d.loginState&&a.$on("$stateChangeStart",function(a,b){b.data&&b.data.requiresLogin&&(k.isAuthenticated||(a.preventDefault(),f.get("$state").go(d.loginState)))}),k.config=d;var o=function(a){var b=l("loginSuccess");if(!(a.popup||a.username||a.email||b&&0!==b.length))throw new Error("You must define a loginSuccess handler if not using popup mode or not doing ro call because that means you are doing a redirect")};return k.hookEvents=function(){},k.getToken=function(a){a=a||{scope:"openid"},a.id_token||a.refresh_token||(a.id_token=k.idToken);var b=i.promisify(d.auth0js.getDelegationToken,d.auth0js);return b(a).then(function(a){return a.id_token})},k.refreshIdToken=function(a){var b=i.promisify(d.auth0js.refreshToken,d.auth0js);return b(a||k.refreshToken).then(function(a){return a.id_token})},k.renewIdToken=function(a){var b=i.promisify(d.auth0js.renewIdToken,d.auth0js);return b(a||k.idToken).then(function(a){return a.id_token})},k.signin=function(a,c,f,g){a=a||{},o(a);var h=b("signin",g),j=c?function(a,b,d,e,f){n(b,d,e,f,a).then(function(a){c&&c(a,b,d,e,f)})}:null,k=f?function(a){m("loginFailure",{error:a}),f&&f(a)}:null,l=i.callbackify(h,j,k,e[g||d.lib].library());l(a)},k.signup=function(a,c,e){a=a||{},o(a);var f=c?function(b,d,e,f,g){angular.isUndefined(a.auto_login)||a.auto_login?n(d,e,f,g,b).then(function(a){c&&c(a,d,e,f,g)}):c()}:null,g=e?function(a){m("loginFailure",{error:a}),e&&e(a)}:null,h=d.auth0lib,j=i.callbackify(b("signup"),f,g,h);j(a)},k.reset=function(a,c,e){a=a||{};var f=d.auth0lib,g=i.callbackify(b("reset"),c,e,f);g(a)},k.signout=function(){k.isAuthenticated=!1,k.profile=null,k.profilePromise=null,k.idToken=null,k.state=null,k.accessToken=null,k.tokenPayload=null,m("logout")},k.authenticate=function(a,b,c,d,e){n(b,c,d,e,a,!0)},k.getProfile=function(a){var b=i.promisify(d.auth0lib.getProfile,d.auth0lib);return k.profilePromise=b(a||k.idToken),k.profilePromise.then(function(a){return k.profile=a,a})},k}]}])}();
